<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cartes ‚Äî Aniversari</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Handwriting font for medieval cards -->
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Keep inline card source hidden on the page; cards are shown via "Veure carta" */
    .inline-card { display: none !important; }
  </style>
</head>
<body id="memories">
  <nav class="topnav">
    <div class="nav-inner">
      <a class="brand" href="index.html">Aniversari</a>
      <div class="links">
        <a href="index.html">Inici</a>
        <a href="gallery.html">Galeria</a>
        <a href="memories.html">Cartes</a>
       
      </div>
    </div>
  </nav>

  <main class="container">
    <section class="timeline">
      <h2>Les nostres cartes</h2>

        <!-- Example inline card inserted below -->
        <div class="inline-card" data-name="L'amor de la teva vida" data-subject="Carta d'erasmus">
      Ja queda menys per retrobar-nos: exactament queden 42 dies per tornar a sentir la teva escalfor, el teu carinyo, les teves abra√ßades, els teus petons, el teu cor bategant i la teva panxa fent sorollets. B√†sicament cada dia queda menys per sentir el teu amor, un amor infinit i incondicional que em fa sentir viu i amb ganes de tirar endavant, de formar una fam√≠lia i un futur junts.

      Mai hauria pensat que es pogu√©s arribar a estimar tant alg√∫ que fa dos anys era com un desconegut per a mi, i que poc a poc ens hem anat coneixent i connectant m√©s, fins al punt que no puc viure sense tu i no m‚Äôimagino la meva vida sense els teus bons dies i les teves bones nits, les teves trucades i les teves bromes.

      Ara estem en un moment complicat i nou per a nosaltres, per√≤ sento que ens portar√† m√©s a prop que mai. Faig aquesta petita carta perqu√® vegis que penso sempre en tu i perqu√® et puguis sentir m√©s a prop meu.

      T‚Äôestimo. Un pet√≥.

      Molta sort el primer dia de la uni! &lt;3

      L‚Äôamor de la teva vida
      </div>

      <section>
        <div id="cardList" class="grid"></div>
      </section>
    </section>
  </main>

  <footer class="footer">
    <p>Les cartes queden guardades localment üíå</p>
  </footer>

  <script>
    (function(){
      const list = document.getElementById('cardList');

      function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

      // minimal medieval viewer
      let viewer = null;
      function ensureViewer(){
        if(viewer) return;
        viewer = document.createElement('div');
        viewer.id = 'cardViewerOverlay';
        viewer.style.display = 'none';
        viewer.innerHTML = `
          <div class="cv-backdrop" tabindex="-1">
            <div class="cv-card medieval" role="dialog" aria-modal="true">
              <button class="cv-close" aria-label="Tancar">‚úï</button>
              <div class="cv-header">
                <h3 class="cv-subject">Carta</h3>
                <div class="cv-meta"></div>
              </div>
              <div class="cv-content"></div>
              <div class="cv-actions">
                <button class="btn" id="cv-print">Imprimir</button>
                <a class="btn secondary" id="cv-download" download>Descarrega</a>
              </div>
            </div>
          </div>`;
        document.body.appendChild(viewer);
        const backdrop = viewer.querySelector('.cv-backdrop');
        backdrop.addEventListener('click', (e)=>{ if(e.target === backdrop) closeViewer(); });
        viewer.querySelector('.cv-close').addEventListener('click', closeViewer);
        document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeViewer(); });
        viewer._content = {
          subject: viewer.querySelector('.cv-subject'),
          meta: viewer.querySelector('.cv-meta'),
          content: viewer.querySelector('.cv-content'),
          download: viewer.querySelector('#cv-download'),
          print: viewer.querySelector('#cv-print')
        };
      }

      function closeViewer(){ if(!viewer) return; try{ const a = viewer._content.download; if(a && a.href && a.href.startsWith('blob:')) URL.revokeObjectURL(a.href); }catch(e){} viewer.style.display = 'none'; }

      function showCard(text, meta){
        ensureViewer();
        viewer._content.subject.textContent = meta.subject || 'Carta';
        viewer._content.meta.textContent = meta.name || 'An√≤nim';
        viewer._content.content.innerHTML = `<div class="medieval-text">${escapeHtml(text)}</div>`;
        try{ const blob = new Blob([text], {type:'text/plain;charset=utf-8'}); const url = URL.createObjectURL(blob); viewer._content.download.href = url; viewer._content.download.download = (meta.filename || (meta.subject || 'carta') + '.txt'); }catch(e){ viewer._content.download.removeAttribute('href'); }
        viewer._content.print.onclick = ()=>{ const w = window.open('','_blank','width=800,height=700'); if(!w) return alert("No s'ha pogut obrir la finestra d'impressi√≥."); const html = `<html><head><title>${escapeHtml(meta.subject||"Carta")}</title></head><body><pre style="white-space:pre-wrap;font-family:Georgia, \"Times New Roman\", serif;font-size:16px">${escapeHtml(text)}</pre></body></html>`; w.document.write(html); w.document.close(); w.focus(); w.print(); };
        viewer.style.display = 'block'; viewer.querySelector('.cv-backdrop').focus();
      }

      function renderInline(){
        list.innerHTML = '';
        const nodes = Array.from(document.querySelectorAll('.inline-card'));
        if(nodes.length === 0) { list.innerHTML = '<p class="help">No hi ha cartes escrites dins del HTML. Afegeix un element <code class="help">&lt;div class="inline-card" ...&gt;...</code>.</p>'; return; }
        nodes.forEach(n=>{
          const entry = {
            name: n.dataset.name || '',
            subject: n.dataset.subject || '',
            text: (n.textContent || '').trim()
          };
          const card = document.createElement('div'); card.className = 'card';
          const h = document.createElement('h4'); h.textContent = entry.subject || 'Carta';
          const meta = document.createElement('div'); meta.className='meta'; meta.textContent = entry.name || 'An√≤nim';
          card.appendChild(h); card.appendChild(meta);
          const btn = document.createElement('button'); btn.className='btn secondary'; btn.textContent='Veure carta';
          btn.addEventListener('click', ()=> showCard(entry.text, {name: entry.name, subject: entry.subject, when: entry.when, filename: entry.filename}));
          card.appendChild(btn);
          list.appendChild(card);
        });
      }

      renderInline();
    })();
  </script>

  <!-- SVG mask for torn/burnt parchment edges -->
  <svg width="0" height="0" style="position:absolute">
    <defs>
      <clipPath id="parchment-torn" clipPathUnits="objectBoundingBox">
        <path d="M 0.015,0.02 C 0.018,0.015 0.025,0.018 0.032,0.012 C 0.04,0.006 0.048,0.01 0.056,0.008 C 0.07,0.005 0.085,0.009 0.1,0.007 L 0.15,0.011 C 0.17,0.008 0.19,0.013 0.21,0.01 L 0.28,0.006 C 0.31,0.009 0.34,0.007 0.37,0.01 L 0.45,0.008 C 0.49,0.011 0.53,0.008 0.57,0.01 L 0.63,0.007 C 0.67,0.01 0.71,0.008 0.75,0.011 L 0.82,0.009 C 0.85,0.012 0.88,0.008 0.91,0.01 C 0.93,0.007 0.95,0.011 0.97,0.008 C 0.982,0.012 0.99,0.025 0.992,0.04 L 0.995,0.08 C 0.993,0.11 0.996,0.14 0.994,0.17 L 0.997,0.23 C 0.995,0.27 0.997,0.31 0.995,0.35 L 0.998,0.42 C 0.996,0.46 0.998,0.5 0.996,0.54 L 0.999,0.61 C 0.997,0.65 0.999,0.69 0.997,0.73 L 1,0.8 C 0.998,0.83 1,0.86 0.998,0.89 C 0.996,0.91 0.999,0.93 0.997,0.95 C 0.993,0.97 0.985,0.982 0.97,0.988 L 0.93,0.992 C 0.9,0.99 0.87,0.993 0.84,0.991 L 0.78,0.994 C 0.74,0.992 0.7,0.994 0.66,0.992 L 0.59,0.996 C 0.55,0.993 0.51,0.996 0.47,0.994 L 0.4,0.997 C 0.36,0.995 0.32,0.997 0.28,0.995 L 0.21,0.998 C 0.17,0.996 0.13,0.998 0.09,0.996 L 0.04,0.999 C 0.025,0.994 0.018,0.982 0.012,0.965 C 0.008,0.945 0.011,0.925 0.009,0.905 L 0.006,0.86 C 0.008,0.83 0.006,0.8 0.008,0.77 L 0.005,0.71 C 0.007,0.67 0.005,0.63 0.007,0.59 L 0.004,0.52 C 0.006,0.48 0.004,0.44 0.006,0.4 L 0.003,0.33 C 0.005,0.29 0.003,0.25 0.005,0.21 L 0.002,0.14 C 0.004,0.1 0.002,0.06 0.004,0.02 Z"/>
      </clipPath>
    </defs>
  </svg>
</body>
</html>
